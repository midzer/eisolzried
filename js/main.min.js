function hasEventInDate(e,t){if(e.isRecurring()){var a=e.iterator(t);if(0==a.next().compare(t))return!0}else if(e.startDate.day==t.day&&e.startDate.month==t.month&&e.startDate.year==t.year)return!0;return!1}function createEventDetails(e){var t="<p>Treffpunkt: "+e.location+"<br />Beginn: "+e.startDate.toJSDate().toTimeString().substring(0,5)+"<br />Ende: "+e.endDate.toJSDate().toTimeString().substring(0,5)+"</p>";t+="<p>"+e.description+"</p>";var a=e.attachments;for(var n in a)t+='<a href="'+a[n].getFirstValue()+'">Zusatzinfo</a>';return t}function buildCal(e){var t=ICAL.parse(e),a=new ICAL.Component(t),n=a.getAllSubcomponents("vevent"),r=[];for(var i in n)r[i]=new ICAL.Event(n[i]);var o=drcal({weekdays:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],months:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],startDay:1});o.addEventListener("drcal.renderDay",function(e){var t=document.createElement("div");t.className="daynum",t.appendChild(document.createTextNode(e.detail.date.getDate())),e.detail.element.appendChild(t);var a=ICAL.Time.fromJSDate(e.detail.date);for(var n in r)if(hasEventInDate(r[n],a)){var i=document.createElement("div");i.className="dayevent",i.appendChild(document.createTextNode(r[n].summary)),e.detail.element.appendChild(i)}}),o.changeMonth(new Date);var d=$("<div />").dialog({autoOpen:!1,width:200});o.addEventListener("click",function(e){if("DIV"==e.target.tagName){var t=ICAL.Time.fromDateString(e.target.parentNode.getAttribute("date"));for(var a in r)if(hasEventInDate(r[a],t)&&e.target.innerHTML==r[a].summary){d.html(createEventDetails(r[a])),d.dialog("option","title",r[a].summary),d.dialog("option","position",{my:"top+20",at:"bottom+20",of:e,collision:"flipfit",within:document.getElementById("drcal")}),d.dialog("open");break}}});for(var l=o.querySelectorAll("button"),i=0;i<l.length;i++)l[i].classList.add("btn");document.getElementById("drcal").appendChild(o)}longlist(document.getElementById("posts"),{perPage:5}),$.get("data/termine.ics").then(buildCal);